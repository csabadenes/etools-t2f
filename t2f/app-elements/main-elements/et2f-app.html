<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../app-behaviors/api-behavior.html">
<link rel="import" href="../api-elements/structure-data.html">
<link rel="import" href="../api-elements/permissions-data.html">


<dom-module id="et2f-app">

  <template>

    <style include="shared-styles">

      :host {
        display: block;
      }

    </style>

    <et2f-structure-data loading="{{structureLoading}}"
    structure="{{structure}}">
    </et2f-structure-data>

    <et2f-permissions-data loading="{{permissionsLoading}}"
      et2f-permissions="{{et2fPermissions}}">
    </et2f-permissions-data>

    <iron-pages id="pages"
      selected="[[page]]"
      attr-for-selected="name"
      fallback-selection="not-found"
      role="main">

      <page-travel-list name="travel-list"
        user="[[user]]"
        structure="[[structure]]"
        route="{{route}}"
        refresh-data="{{refreshData}}"
        list-loading="{{subLoading}}">
      </page-travel-list>

      <page-action-points-list name="action-points-list"
        user="[[user]]"
        structure="[[structure]]"
        route="{{route}}"
        refresh-data="{{refreshData}}"
        list-loading="{{subLoading}}">
      </page-action-points-list>

      <page-edit-travel fullbleed
        name="edit-travel"
        user="[[user]]"
        route="{{route}}"
        detail-loading="{{subLoading}}"
        travel-id="[[subroute.path]]"
        et2f-permissions="[[et2fPermissions.travel]]"
        structure="[[structure]]"></page-edit-travel>

      <page-invoices-list name="invoices-list"
        user="[[user]]"
        structure="[[structure]]"
        route="{{route}}"
        refresh-data="{{refreshData}}"
        list-loading="{{subLoading}}">
      </page-invoices-list>

      <page-action-point fullbleed
        name="action-point"
        user="[[user]]"
        route="{{route}}"
        detail-loading="{{subLoading}}"
        action-point-id="[[subroute.path]]"
        et2f-permissions="[[et2fPermissions]]"
        structure="[[structure]]"></page-action-point>

      <page-invoice-detail fullbleed
        name="invoice-detail"
        user="[[user]]"
        route="{{route}}"
        detail-loading="{{subLoading}}"
        invoice-id="[[subroute.path]]"
        et2f-permissions="[[et2fPermissions.travel]]"
        structure="[[structure]]"></page-invoice-detail>

      <page-not-found name="not-found"></page-not-found>

      <page-permission-matrix-edit name="permission-matrix-edit"
      et2f-permissions="[[et2fPermissions]]">
      </page-permission-matrix-edit>


    </iron-pages>


  </template>

  <script>
    Polymer({

      is: 'et2f-app',

      properties: {
        refreshData: {
          type: Boolean,
          value: false
        },
        structure: Object,
        et2fPermissions: Object,
        user: {
          type: Object
        },
        route: {
          type: Object,
          notify: true
        },
        subroute: {
          type: Object,
          notify: true
        },
        page: {
          type: Object,
          notify: true
        },
        structureLoading: Boolean,
        permissionsLoading: {
          type: Boolean,
        },
        loading: {
          type: Boolean,
          notify: true,
          computed: '_computeLoading(structureLoading, permissionsLoading, subLoading)',
        },
        subLoading: {
          type: Boolean,
          value: false
        }
      },
      _computeLoading: function(structure, permissions, subLoading) {
        return structure || permissions || subLoading;
      }

    });

  </script>

</dom-module>

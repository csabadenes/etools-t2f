<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../app-config/etools-app-config.html">
<link rel="import" href="./pdf-images.html">

<dom-module id="ta-print">

  <template>
    <pdf-make output="open" print="{{openPDF}}" images="{{images}}" content="[[dataToPrint]]" styles="[[printStyles]]" page-orientation="portrait"></pdf-make>
    <pdf-images unicef-logo="{{unicefLogo}}" black-line="{{blackLine}}"> </pdf-images>
  </template>

  <script>

    Polymer({

      is: 'ta-print',

      properties: {
        data: {
          type: Object,
        },
        dataToPrint: {
          type: Object,
          computed: '_computeDataToPrint(data)',
        },
        printStyles: {
          type: Object,
          computed: '_computeStyles(data)',
        },
        openPDF: {
          type: Boolean,
          value: false
        },
        unicefLogo: String,
        blackLine: String,
        images: {
          type: Object,
          computed: '_computeImages(unicefLogo, blackLine)'
        }
      },
      _computeStyles: function() {
        return {
          mainHeader: {
            fontSize: 16,
            bold: true,
            color: '#FFFFFF',
            fillColor: '#000000'
          },
          checkbox: {
            bold: true,
            color: '#FFFFFF',
            fillColor: '#000000'
          },
          checkboxRight: {
            bold: true,
            color: '#FFFFFF',
            fillColor: '#000000',
            alignment: 'right'
          },
          rightAlign: {
            alignment: 'right'
          },
          centerAlign: {
            alignment: 'center'
          }
        };
      },
      _computeImages: function(unicefLogo, blackLine) {
        return {
          unicefLogo: unicefLogo,
          // blackLine: blackLine
        };
      },
      _computeDataToPrint: function(incomingData) {
        if (!incomingData.baseDetails) {
          return;
        }
        var data = JSON.parse(JSON.stringify(incomingData));
        var dataToPrint = [];

        function concatManyToMany(value) {
          if (value instanceof Array) {
            return value.reduce(function(prev, cur, index) {
              var tail = index === value.length - 1 ? '' : ',';
              return prev + cur.label + tail;
            }, '');
          }
          return '';
        }

        dataToPrint.push({
          image: 'unicefLogo',
          fit: [212,50],
          margin: [151,0]
        });

        return dataToPrint;
      },

      printTa: function() {
        this.openPDF = true;
        this.openPDF = false;
      }

    });
  </script>
</dom-module>

<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../app-config/etools-app-config.html">

<dom-module id="ta-print">

  <template>
    <pdf-make output="download" print="{{openPDF}}" content="[[dataToPrint]]" styles="[[printStyles]]" page-orientation="portrait"></pdf-make>
  </template>

  <script>

    Polymer({

      is: 'ta-print',

      properties: {
        data: {
          type: Object,
        },
        dataToPrint: {
          type: Object,
          computed: '_computeDataToPrint(data)',
        },
        printStyles: {
          type: Object,
          computed: '_computeStyles(data)',
        },
        openPDF: {
          type: Boolean,
          value: false
        },
        images: {
          type: Object,
          computed: '_computeImages(data)'
        }
      },

      _computeImages: function() {
        var images = {};
        function imageToBase64(url, name) {
          var xhr = new XMLHttpRequest();
          xhr.responseType = 'blob';
          xhr.onload = function() {
            var reader = new FileReader();
            reader.onloadend = function() {
              image.name = reader.result;
            };
            reader.readAsDataURL(xhr.response);
          };
          xhr.open('GET', url);
          xhr.send();
        }
        return images;
      },

      _computeStyles: function() {
        return {
          mainHeader: {
            fontSize: 16,
            bold: true,
            color: '#FFFFFF',
            fillColor: '#000000'
          },
          checkbox: {
            bold: true,
            color: '#FFFFFF',
            fillColor: '#000000'
          },
          checkboxRight: {
            bold: true,
            color: '#FFFFFF',
            fillColor: '#000000',
            alignment: 'right'
          },
          rightAlign: {
            alignment: 'right'
          }
        };
      },

      _computeDataToPrint: function(incomingData) {
        if (!incomingData.baseDetails) {
          return;
        }
        var data = JSON.parse(JSON.stringify(incomingData));
        var dataToPrint = [];

        function concatManyToMany(value) {
          if (value instanceof Array) {
            return value.reduce(function(prev, cur, index) {
              var tail = index === value.length - 1 ? '' : ',';
              return prev + cur.label + tail;
            }, '');
          }
          return '';
        }

        return dataToPrint;
      },

      printTa: function() {
        this.openPDF = true;
        this.openPDF = false;
      }

    });
  </script>
</dom-module>

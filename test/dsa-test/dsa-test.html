<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>test DSA CALCULATION</title>

  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>

  <link rel="import" href="../../t2f/app-elements/api-elements/outbound-data.html">
  <link rel="import" href="../../t2f/app-elements/field-set-elements/travel-deductions.html">

  <link rel="import" href="./data/case-1.html">

</head>
<body>

<test-fixture id="el">
  <template>
    <et2f-outbound-data postData="true" id="api"></et2f-outbound-data>
    <travel-deductions id="deductions"></travel-deductions>
  </template>
</test-fixture>

<script>

  /* global define, suite, setup, fixture, test, caseScenarios, expect */
  suite('dsa-test', function() {

    var el = null;
    var dom = null;
    var deductions = null;
    var api = null;
    var data = caseScenarios;

    setup(function() {

      el = fixture('el');
      dom = Polymer.dom(el.root);

      deductions = dom.querySelector('#deductions');
      api = dom.querySelector('#api');
    });

    test('base#1 - it parses injected deduction', function() {

      deductions.itinerary = data.simple.itinerary;
      deductions.deductions = [];
      data.simple.deductions = deductions.deductions;

      if (expect(data.simple.deductions.length).to.equal(1)) {
        console.log('âœ…');
      } else {
        console.log('ðŸ’”');
      }
    });

    test('base#2 - the API sends data to the server, and we\'re getting it back', function(done) {

      deductions.itinerary = data.simple.itinerary;
      deductions.deductions = [];
      data.simple.deductions = deductions.deductions;

      api.data = JSON.parse(JSON.stringify(data.simple));

      api._handlePostSuccess = function(e, data) {

        if (expect(data).to.be.an('object')) {
          console.log('âœ…');
        } else {
          console.log('ðŸ’”');
        }
        done();
      }

      api.doRequest({endPoint: 'save'});
    });

    test('base#3 - it generates deductions correctly', function() {

      console.log('ðŸš§');
    });

    test('case#0 - Simple usecase', function(done) {

      deductions.itinerary = data.simple.itinerary;
      deductions.deductions = [];
      data.simple.deductions = deductions.deductions;

      api.data = JSON.parse(JSON.stringify(data.simple));

      api._handlePostSuccess = function(e, data) {

        var gotBackDsa = data.cost_summary.dsa_total;

        console.info('Total DSA of two day simple trip (back and forth, no deduction) should be 140% of base DSA(300$)');
        console.info('420.00', '<= should be');
        console.info(gotBackDsa, '<= is');

        if (expect(gotBackDsa).to.equal('420.00')) {console.log('âœ…')}
        done();
      };

      api.doRequest({endPoint: 'save'});
    });

    test('case#1 - Over 60 days', function(done) {

      deductions.itinerary = data.longerThan60.itinerary;
      deductions.deductions = [];
      data.longerThan60.deductions = deductions.deductions;

      api.data = JSON.parse(JSON.stringify(data.longerThan60));

      api._handlePostSuccess = function(e, data) {

        var gotBackDsa = data.cost_summary.dsa_total;

        console.info('Total DSA of 92 day long simple trip (back and forth, no deduction) should be 18.000 + 6200 + 80 = 24.280$');
        console.info('24280.00', '<= should be');
        console.info(gotBackDsa, '<= is');

        if (expect(gotBackDsa).to.equal('24280.00')) {console.log('âœ…')}
        done();
      };

      api.doRequest({endPoint: 'save'});
    });

    test('case#2 - Same day travel, 8- hrs', function(done) {

      deductions.itinerary = data.sameDay.itinerary;
      deductions.deductions = [];
      data.sameDay.deductions = deductions.deductions;

      api.data = JSON.parse(JSON.stringify(data.sameDay));

      api._handlePostSuccess = function(e, data) {

        var gotBackDsa = data.cost_summary.dsa_total;

        console.info('Total DSA of less than 8 hours trip (back and forth, no deduction) should be 0$');
        console.info('0.00', '<= should be');
        console.info(gotBackDsa, '<= is');

        if (expect(gotBackDsa).to.equal('0.00')) {console.log('âœ…')}
        done();
      };

      api.doRequest({endPoint: 'save'});
    });

    test('case#3 - Same day travel, 8+ hrs', function(done) {

      deductions.itinerary = data.sameDayLonger.itinerary;
      deductions.deductions = [];
      data.sameDayLonger.deductions = deductions.deductions;

      api.data = JSON.parse(JSON.stringify(data.sameDayLonger));

      api._handlePostSuccess = function(e, data) {

        var gotBackDsa = data.cost_summary.dsa_total;

        console.info('Total DSA of more than 8 hours trip (back and forth, no deduction) should be 40% * 300 = 120$$');
        console.info('120.00', '<= should be');
        console.info(gotBackDsa, '<= is');

        if (expect(gotBackDsa).to.equal('0.00')) {console.log('âœ…')}
        done();
      };

      api.doRequest({endPoint: 'save'});
    });

    test('case#4 - Overnight travel', function() {});

    test('case#5 - No DSA checked', function() {});
    test('case#6 - Dinner, lunch, breakfast', function() {});
    test('case#7 - Multiple DSAs', function() {});
    test('case#8 - Currency issues?', function() {});

    test('case#7 - Really complex calculation A', function() {});
    test('case#8 - Really complex calculation B', function() {});
    test('case#9 - Really complex calculation C', function() {});

  });
</script>

</body>
</html>
